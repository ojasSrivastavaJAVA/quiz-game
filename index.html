<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ojas vs Dhruv Quiz Game</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Ojas vs Dhruv - Quiz Game</h1>

  <!-- Start screen -->
  <div class="start-box" id="start-box">
    <h2>Enter your name to start playing</h2>
    <input type="text" id="playerName" placeholder="Your Name" />
    <br /><br />
    <button onclick="startGame()">Start Game</button>
  </div>

  <!-- Quiz questions -->
  <div class="question-box" id="question-box" style="display: none;">
    <h2 id="question">Question will appear here</h2>
    <div>
      <img id="ojas-img" src="images/ojas.jpeg" alt="Ojas" />
      <img id="dhruv-img" src="images/dhruv.png" alt="Dhruv" />
    </div>
    <div>
      <button onclick="vote('Ojas')">Vote OJAS</button>
      <button onclick="vote('Dhruv')">Vote DHRUV</button>
    </div>
    <p id="progress"></p>
  </div>

  <!-- Result screen -->
  <div class="result-box" id="result-box" style="display: none;">
    <h2>Results</h2>
    <div>
      <img id="ojas-final" src="images/ojas.jpeg" alt="Ojas" />
      <img id="dhruv-final" src="images/dhruv.png" alt="Dhruv" />
    </div>
    <div id="result"></div>
    <button onclick="restartGame()">Play Again</button>
  </div>

  <!-- Scoreboard -->
  <div id="scoreboard"></div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBL55nh3Tox5RCMg0NEdhduBuK1IcvpJQQ",
      authDomain: "quiz-game-8cd1f.firebaseapp.com",
      databaseURL: "https://quiz-game-8cd1f-default-rtdb.firebaseio.com",
      projectId: "quiz-game-8cd1f",
      storageBucket: "quiz-game-8cd1f.firebasestorage.app",
      messagingSenderId: "849501942718",
      appId: "1:849501942718:web:855ecac0534a08ccfbffef",
      measurementId: "G-RNZCVXSYKK"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const questions = [
      "Who looks better?",
      "Who is smarter?",
      "Who is taller?",
      "Who is funnier?",
      "Who is more hardworking?",
      "Who is more confident?",
      "Who is better at sports?",
      "Who is more creative?",
      "Who has a better smile?",
      "Who would you trust more?",
    ];

    let currentQuestion = 0;
    let scores = { Ojas: 0, Dhruv: 0 };
    let playerName = "";

    function startGame() {
      playerName = document.getElementById("playerName").value.trim();
      if (!playerName) {
        alert("Please enter your name to start!");
        return;
      }
      document.getElementById("start-box").style.display = "none";
      document.getElementById("question-box").style.display = "block";
      loadQuestion();
    }

    function loadQuestion() {
      if (currentQuestion < questions.length) {
        document.getElementById("question").innerText = questions[currentQuestion];
        document.getElementById("progress").innerText = `${playerName}, Question ${currentQuestion + 1} of ${questions.length}`;
      } else {
        showResult();
      }
    }

    function vote(person) {
      scores[person]++;
      currentQuestion++;
      loadQuestion();
    }

    function showResult() {
      document.getElementById("question-box").style.display = "none";
      document.getElementById("result-box").style.display = "block";

      let resultText = `${playerName}, here are the final scores:<br><br>`;
      resultText += `OJAS: ${scores.Ojas}<br>DHRUV: ${scores.Dhruv}<br><br>`;

      let winnerCardHTML = "";
      if (scores.Ojas > scores.Dhruv) {
        winnerCardHTML = `<div class="winner-card"><img src="images/ojas.jpeg" alt="Ojas" /> üèÜ OJAS Wins!</div>`;
      } else if (scores.Dhruv > scores.Ojas) {
        winnerCardHTML = `<div class="winner-card"><img src="images/dhruv.png" alt="Dhruv" /> üèÜ DHRUV Wins!</div>`;
      } else {
        winnerCardHTML = `<div class="winner-card" style="background: #555;">ü§ù It's a Tie!</div>`;
      }

      document.getElementById("result").innerHTML = resultText + winnerCardHTML;

      // Save scores safely
      saveScore(playerName + " (Ojas)", scores.Ojas);
      saveScore(playerName + " (Dhruv)", scores.Dhruv);
    }

    function restartGame() {
      currentQuestion = 0;
      scores = { Ojas: 0, Dhruv: 0 };
      document.getElementById("result-box").style.display = "none";
      document.getElementById("start-box").style.display = "block";
      document.getElementById("playerName").value = "";
    }

    // ---- Firebase functions ----

    function saveScore(name, score) {
      if (!name || typeof score !== "number") return;

      db.ref("scores").push({
        name: name,
        score: score,
        timestamp: Date.now()
      })
      .then(() => {
        console.log("Score saved:", name, score);
        loadScores();
      })
      .catch(err => console.error("Error saving score:", err));
    }

    function loadScores() {
  db.ref("scores").get().then(snapshot => {
    if (!snapshot.exists()) {
      document.getElementById("scoreboard").innerHTML = "<p>No scores yet</p>";
      return;
    }

    const items = [];
    snapshot.forEach(child => {
      const val = child.val();
      if (val && typeof val.score === "number" && val.name) items.push(val);
    });

    // Separate scores by player
    const playerScores = {};
    items.forEach(item => {
      // Extract player name and who (Ojas/Dhruv) from saved name
      const match = item.name.match(/(.+)\s\((Ojas|Dhruv)\)$/);
      if (!match) return;
      const player = match[1];
      const who = match[2];

      if (!playerScores[player]) playerScores[player] = { Ojas: 0, Dhruv: 0 };
      playerScores[player][who] = item.score;
    });

    // Build table
    let html = `<h2>üèÜ Scoreboard</h2>`;
    html += `<table border="1" cellpadding="5" cellspacing="0">
              <tr>
                <th>Player</th>
                <th>Ojas</th>
                <th>Dhruv</th>
              </tr>`;

    // Sort players alphabetically or by total score
    const sortedPlayers = Object.keys(playerScores);
    sortedPlayers.forEach(player => {
      const ojasScore = playerScores[player].Ojas || 0;
      const dhruvScore = playerScores[player].Dhruv || 0;
      html += `<tr>
                 <td>${player}</td>
                 <td>${ojasScore}</td>
                 <td>${dhruvScore}</td>
               </tr>`;
    });

    html += `</table>`;

    document.getElementById("scoreboard").innerHTML = html;
  }).catch(err => console.error("Error loading scores:", err));
}


    // Load scoreboard on page load
    window.addEventListener("load", loadScores);
  </script>
</body>
</html>

